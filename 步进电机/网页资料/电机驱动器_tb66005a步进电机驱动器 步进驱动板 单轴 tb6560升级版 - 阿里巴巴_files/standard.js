define(["jquery","require","lofty/lang/observer","lofty/util/misc/2.0/misc"],function(t,e,n,i){"use strict";t(function(){function a(t){f[0].setAttribute("placeholder",t.placeholder),F.placeholderInit(t.placeholder),h&&(t.suggest!==!1?("info"==t.type?(b=v,h.disable()):(v.disable(),b=h,h.setInputHandlerOptions("type",t.type)),b.enable()):(h.disable(),v.disable())),y.removeClass().addClass(t.cls),"object"==typeof t.action?y.attr("action",t.action.firstBtnUrl||""):y.attr("action",t.action)}function o(e){if(k.length&&P.length&&(k.val("industrySearch"),P.val(e.data("industryFlag")||"")),W.length)for(var n=W.find("input"),i=0,a=n.length;a>i;i++){var o=t(n[i]);o.attr("name",o.attr("init-name")),o.val(o.attr("init-val"))}if(H.length){var s=H.find("input");s.removeAttr("name"),s.val("")}var r;r=m&&"undefined"!=typeof m.action?"object"==typeof m.action?m.action.firstBtnUrl||"":m.action:y.data("default-action"),r&&y.attr("action",r)}function s(e){if(H.length)for(var n=H.find("input"),i=0,a=n.length;a>i;i++){var o=t(n[i]);o.attr("name",o.attr("init-name")),o.val(o.attr("init-val"))}if(W.length){var s=W.find("input");s.removeAttr("name"),s.val("")}k.length&&P.length&&(k.val("marketSearch"),P.val(""));var r;r=m&&"object"==typeof m.action&&m.action.secondBtnUrl?m.action.secondBtnUrl:e.data("action"),r&&y.attr("action",r)}function r(i,a){e.use(["lofty/alicn/suggestion/3.0/suggestion","fdevlib/css/lofty/alicn/suggestion/3.0/suggestion.css"],function(e){var r=t(".alisearch-container .alisearch-box",u).css("background-color")||"#e8e8e8",l={mod:"mohe",industryFlag:P.val(),extraParams:"sellerid="+t("#usermidid").text(),encoding:a};"info"!==i.type&&(l.type=i.type),h=new e({target:f,inputHandlerOptions:l,noInputHandlerOptions:{type:"simple",industryFlag:P.val()},dTop:6}),h.on("show",function(e){f.addClass("active"),h.resetPosition(),h.resetWidth(),t(".suggest_input_ctn,.suggest_no_input_ctn_simple").css("border-color",r)}),h.on("hide",function(t){f.removeClass("active")});for(var c=[],g=[],p=0,m=t(".part-searchInSite").length;m>p;p++)c[p]=t(".part-searchInSite").eq(p).find("[name=keywords]"),g[p]=new e({target:c[p],inputHandlerOptions:l,noInputHandlerOptions:{type:"simple",industryFlag:P.val()},dTop:6}),g[p].on("show",function(e){f.addClass("active"),h.resetPosition(),h.resetWidth(),t(".suggest_input_ctn,.suggest_no_input_ctn_simple").css("border-color",r)}),g[p].on("hide",function(t){f.removeClass("active")}),g[p].on("submit",function(e){return function(n){if(O(n)){var i=c[e].closest("form");n&&n.actionParams&&t.each(n.actionParams,function(t,e){i.append('<input type="hidden" name="'+t+'" value="'+e+'">')}),i.submit()}}}(p));var v=function(e){if(O(e)){var n=t("button.market",d);n.length?o(n):(n=t("button.global,button.single",d),s(n)),e&&e.actionParams&&t.each(e.actionParams,function(t,e){y.append('<input type="hidden" name="'+t+'" value="'+e+'">')}),y.submit()}};h.on("submit",function(t){v(t)}),n.on("reset_masthead_suggestion",function(e){h.hide(),h.resetPosition(),h.resetWidth(),t.each(g,function(t,e){e.hide(),e.resetPosition(),e.resetWidth()})});var b;t(window).on("resize._masthead_suggest_",function(){b&&clearTimeout(b),b=setTimeout(function(){b=null,h.hide(),h.resetPosition(),h.resetWidth()},50)})})}function l(i,a){e.use(["lofty/alicn/suggestion/3.0/industry/suggestion","fdevlib/css/lofty/alicn/suggestion/3.0/industry/suggestion.css"],function(e){var r=t(".alisearch-container .alisearch-box",u).css("background-color")||"#e8e8e8",l={encoding:a},c=new e({target:f,dTop:5,suggestId:i,inputHandlerOptions:l});c.on("show",function(e){f.addClass("active"),c.resetPosition(),c.resetWidth(),t(".industry_suggest_ctn").css("border-color",r).css("border-width","1px")}),c.on("hide",function(t){f.removeClass("active")});var g=function(e){if(O(e)){var n=t("button.market",d);n.length?o(n):(n=t("button.global,button.single",d),s(n));for(var i in e.actionParams)x.append('<input type="hidden" name="'+i+'" value="'+e.actionParams[i]+'" />');y.submit()}};c.on("submit",function(t){g(t)}),b=c,n.on("reset_masthead_suggestion",function(t){c.hide(),c.resetPosition(),c.resetWidth()});var p;t(window).on("resize._masthead_suggest_",function(){p&&clearTimeout(p),p=setTimeout(function(){p=null,c.hide(),c.resetPosition(),c.resetWidth()},50)})})}function c(i,a){e.use(["lofty/alicn/suggestion/3.0/suggestion","lofty/alicn/suggestion/3.0/wiki/suggestion","fdevlib/css/lofty/alicn/suggestion/3.0/suggestion.css","fdevlib/css/lofty/alicn/suggestion/3.0/wiki/suggestion.css"],function(e,r){var l=t(".alisearch-container .alisearch-box",u).css("background-color")||"#e8e8e8",c={mod:"mohe",industryFlag:P.val(),encoding:a},g=6;"new"===t("input[name=mastheadtype]").val()&&(g=0),"info"!==i.type&&(c.type=i.type),h=new e({target:f,inputHandlerOptions:c,noInputHandlerOptions:{type:"simple",industryFlag:P.val()},dTop:g}),h.on("show",function(e){f.addClass("active"),h.resetPosition(),h.resetWidth(),t(".suggest_input_ctn,.suggest_no_input_ctn_simple").css("border-color",l)}),h.on("hide",function(t){f.removeClass("active")}),v=new r({target:f,dTop:6,encoding:a}),v.on("show",function(e){f.addClass("active"),v.resetPosition(),v.resetWidth(),t(".wiki_suggest_ctn,.suggest_default_ctn").css("border-color",l)}),v.on("hide",function(t){f.removeClass("active")}),"info"!==i.type?(b=h,v.disable()):(b=v,h.disable());var p=function(e){if(O(e)){var n=t("button.market",d);n.length?o(n):(n=t("button.global,button.single",d),s(n)),y.submit()}};h.on("submit",function(t){p(t)}),v.on("submit",function(t){p(t)}),n.on("reset_masthead_suggestion",function(t){h.hide(),h.resetPosition(),h.resetWidth(),v.hide(),v.resetPosition(),v.resetWidth()});var m;t(window).on("resize._masthead_suggest_",function(){m&&clearTimeout(m),m=setTimeout(function(){m=null,h.hide(),h.resetPosition(),h.resetWidth(),v.hide(),v.resetPosition(),v.resetWidth()},50)})})}var u=t("#ali-masthead-v6");if(u.length){var d=t("div.alisearch-container",u),f=t("input[name=keywords]",d);0===f.length&&(f=t("input[name=keyword]",d));var g,p,m,h,v,b,y=t("form",u),w=t("div.ali-market-list",u),_=t("div.alisearch-type ul",u),k=t("input[name=from]",d),P=t("input[name=industryFlag]",d),T=t("button.market",d),C=t("button.single",d),I=(0===T.length?C:T,!(!t.browser.msie||6!=t.browser.version)),x=t('<div style="display:none"></div>');y.append(x);var W=t(".self-action-parames",u),H=t(".global-action-parames",u),F={placeholderInit:function(e){var n=f;if(e&&n.length>0&&!("placeholder"in document.createElement("input"))){if(g)g.style.left=n.position().left+"px";else{var i=n.attr("id");i||(i="placeholder_"+(new Date).getTime(),n.attr("id",i));var a=document.createElement("label");a.htmlFor=i,a.style.left=n.position().left+"px",n.before(a),g=a,t(a).css({position:"absolute",height:"20px","line-height":"20px","padding-left":"5px",color:"#bbb","z-index":"995",cursor:"text","white-space":"nowrap"})}n.bind("focus",function(){g.innerHTML=""}),n.bind("blur",function(){""==n.val()&&(g.innerHTML=e)});var o,s=(new Date).getTime(),r=60,l=window,c=function(t){var e=(new Date).getTime();return s&&r>e-s?(l.clearTimeout(o),void(o=l.setTimeout(c,r))):(s=e,void(g.style.left=n.position().left+"px"))};t(window).bind("resize",c),""==n.val()&&(g.innerHTML=e)}},typeInit:function(){function e(e,n){var i,o,s=t(this);(n||!s.hasClass("current"))&&(t(">li",_).removeClass("current"),_.removeClass("hover"),s.addClass("current"),_.prepend(s),i=s.data("type"),o=m={placeholder:s.data("placeholder"),suggest:s.data("suggest"),url:s.data("url"),type:s.data("type"),cls:s.data("cls"),action:s.data("action")},a(m),p=i)}if(_.length){var n=_.find("li.current").get(0);_.on("mouseenter",function(){t(this).addClass("hover")}).on("mouseleave",function(){t(this).removeClass("hover")}),_.delegate("li","click",e),t("a",_).click(function(t){t.preventDefault()}),n&&e.call(n,t.Event("click"),!0)}},suggestionInit:function(){if(f.length){m||(m={url:f.data("url"),type:f.data("type"),suggest:f.data("suggest"),placeholder:f.data("placeholder")},f.attr("placeholder",m.placeholder),F.placeholderInit(m.placeholder));var e,n=t(".ali-search .mastheadcfg").data("cfg");"object"==typeof n&&(e=n.mhEncoding),h||m.suggest===!1||(t(d).find("[name=industrySuggestionId]").length>0?l(t(d).find("[name=industrySuggestionId]").val(),e):"winport"===t(d).parents("form").find("[name=suggestiontype]").val()?r(m,e):c(m,e))}},marketInit:function(){I&&w.on("mouseenter",function(){t(this).addClass("hover")}).on("mouseleave",function(){t(this).removeClass("hover")})},actionInit:function(){t("button.market",d).click(function(){var e=b.getSubmitInfo();if(!O(e))return!1;if(o(t(this)),"submit"!==t(this).attr("type")&&y.submit(),""===f.val()&&f.data("placeholder-link")){var n=f.data("placeholder-link");window.open(n,"_blank")}}),t("button.global,button.single",d).click(function(){var e=b.getSubmitInfo();if(!O(e))return!1;if(s(t(this)),"submit"!==t(this).attr("type")&&y.submit(),""===f.val()&&f.data("placeholder-link")){var n=f.data("placeholder-link");window.open(n,"_blank")}})},submitInit:function(){y.get(0).onsubmit=function(){return f.val()?!0:(f.focus(),!1)}}},O=function(t){if(x.html(""),!b)return!0;if(!t)return!0;if(t.type&&"link"==t.type){var e=t.actionUrl;return t.actionParams&&(e=i.addParmToUrl(e,t.actionParams)),i.goTo(e,"_self"),!1}var n,a=!1;for(var o in t.actionParams)"from"==o&&k.length?(k.val(t.actionParams[o]),a=!0):x.append('<input type="hidden" name="'+o+'" value="'+t.actionParams[o]+'" />');if(t.actionUrl){n=y.attr("action"),y.attr("action",t.actionUrl);var s=W.find("input");s.removeAttr("name"),s.val("");var r=H.find("input");return r.removeAttr("name"),r.val(""),a||k.val(""),P.val(""),y.submit(),y.attr("action",n),!1}return!0};for(var S in F)F[S]()}}),t(function(){function e(t){var e="//stat.1688.com/search/queryreport.html";if(t="?static="+t+"&rule_id=501","undefined"!=typeof window.dmtrack)dmtrack.clickstat(e,t);else{var n=new Date;document.images&&((new Image).src=e+t+"&time="+n.getTime())}return!0}t("#ali-masthead-v6 [data-header-trace]").on("mousedown","a",function(n){var i=n.delegateTarget,a=t(i).data("headerTrace")||"";a&&e(a)}),t("#ali-masthead-v6").on("mousedown","button[data-header-trace]",function(n){var i=n.target,a=t(i).data("headerTrace")||"";a&&e(a)})})});;